# üîê Heylock

> **AI-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞–ø–æ–≤** ‚Äî –ø–æ–ª—É—á–∞–π—Ç–µ –∏–Ω—Å–∞–π—Ç—ã –∏–∑ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ-—è–∑—ã–∫–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

[![Next.js](https://img.shields.io/badge/Next.js-16.0-black)](https://nextjs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.0-blue)](https://www.typescriptlang.org/)
[![Tailwind CSS](https://img.shields.io/badge/Tailwind-3.4-38B2AC)](https://tailwindcss.com/)
[![Supabase](https://img.shields.io/badge/Supabase-PostgreSQL-green)](https://supabase.com/)
[![Google Gemini](https://img.shields.io/badge/Google-Gemini_2.5-orange)](https://ai.google.dev/)

---

## üìñ –û –ø—Ä–æ–µ–∫—Ç–µ

**Heylock** ‚Äî —ç—Ç–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø AI-powered –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç–∞—Ä—Ç–∞–ø–∞–º –ø–æ–ª—É—á–∞—Ç—å –∏–Ω—Å–∞–π—Ç—ã –∏–∑ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–∏—Å–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã –∏–ª–∏ —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ —Å–ª–æ–∂–Ω—ã—Ö BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üí¨ **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ-—è–∑—ã–∫–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- üìä **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: –ì—Ä–∞—Ñ–∏–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
- ü§ñ **AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è SQL**: Google Gemini –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤–∞—à –≤–æ–ø—Ä–æ—Å –≤ SQL –∑–∞–ø—Ä–æ—Å
- üîí **–í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤**: –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –æ–ø–∞—Å–Ω—ã—Ö SQL –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚ö° **–†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: –ü—Ä—è–º–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase (PostgreSQL)

---

## üé• –î–µ–º–æ

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

**–í–æ–ø—Ä–æ—Å:** "–ö–∞–∫–∞—è —Å—Ä–µ–¥–Ω—è—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–π?"

**–û—Ç–≤–µ—Ç —Å–∏—Å—Ç–µ–º—ã:**
- üìä **–ì—Ä–∞—Ñ–∏–∫**: Bar chart —Å –º–µ—Ç—Ä–∏–∫–æ–π
- üí¨ **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è**: "–°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–π —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ 56 –º–∏–Ω—É—Ç –∏ 38 —Å–µ–∫—É–Ω–¥..."
- üìà **–î–∞–Ω–Ω—ã–µ**: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (3.4K —Å–µ–∫—É–Ω–¥)

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –≤–æ–ø—Ä–æ—Å–æ–≤:**
- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏: "–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –±—ã–ª–æ —Å–µ—Å—Å–∏–π?"
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã: "–ü–æ–∫–∞–∂–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é"
- –¢–æ–ø —Å–æ–±—ã—Ç–∏–π: "–ö–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á–∞—â–µ –≤—Å–µ–≥–æ?"
- –°—Ä–∞–≤–Ω–µ–Ω–∏—è: "–°–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—ã–ª–æ –≤—á–µ—Ä–∞?"

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### High-Level Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Browser   ‚îÇ      ‚îÇ   Next.js   ‚îÇ      ‚îÇ  Supabase   ‚îÇ
‚îÇ             ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  App Router ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ PostgreSQL  ‚îÇ
‚îÇ  React UI   ‚îÇ      ‚îÇ  API Routes ‚îÇ      ‚îÇ   Database  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                     ‚îÇ   Google    ‚îÇ
                     ‚îÇ   Gemini    ‚îÇ
                     ‚îÇ  2.5 Flash  ‚îÇ
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Component Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     Frontend (React)                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ChatInterface                                        ‚îÇ
‚îÇ  ‚îú‚îÄ MessageBubble (User/AI messages)                 ‚îÇ
‚îÇ  ‚îú‚îÄ ChartRenderer (Recharts: Line, Bar, Pie)        ‚îÇ
‚îÇ  ‚îî‚îÄ LoadingIndicator                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº HTTP POST
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Backend (Next.js API Routes)            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  /api/chat (POST)                                    ‚îÇ
‚îÇ  ‚îú‚îÄ AI Service (Gemini)                             ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ generateSQL()                               ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ interpretResults()                          ‚îÇ
‚îÇ  ‚îú‚îÄ SQL Validator                                    ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ sanitizeSQL()                               ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ validateSQL()                               ‚îÇ
‚îÇ  ‚îú‚îÄ Database Client (Supabase)                      ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ executeSQL() via RPC                        ‚îÇ
‚îÇ  ‚îî‚îÄ Response Formatter                               ‚îÇ
‚îÇ      ‚îú‚îÄ formatChartData()                            ‚îÇ
‚îÇ      ‚îî‚îÄ suggestChartType()                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº SQL Query
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Database (Supabase/PostgreSQL)          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Tables:                                              ‚îÇ
‚îÇ  ‚îú‚îÄ sessions (id, user_id, started_at, duration)    ‚îÇ
‚îÇ  ‚îî‚îÄ events (id, session_id, event_name, timestamp)  ‚îÇ
‚îÇ                                                       ‚îÇ
‚îÇ  RPC Function:                                        ‚îÇ
‚îÇ  ‚îî‚îÄ execute_raw_sql(sql_query text)                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ü§ñ –í—ã–±–æ—Ä AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: Google Gemini

### –ü–æ—á–µ–º—É Gemini 2.5 Flash?

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Gemini 2.5 Flash | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã |
|----------|------------------|--------------|
| **–°–∫–æ—Ä–æ—Å—Ç—å** | ‚ö° –û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π (~3-5s) | OpenAI GPT-4 Turbo (~5-10s) |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | üí∞ $0.15/1M —Ç–æ–∫–µ–Ω–æ–≤ (input) | OpenAI: $10/1M —Ç–æ–∫–µ–Ω–æ–≤ |
| **–ö–æ–Ω—Ç–µ–∫—Å—Ç** | üìÑ 1M —Ç–æ–∫–µ–Ω–æ–≤ | Claude: 200K, GPT-4: 128K |
| **–ö–∞—á–µ—Å—Ç–≤–æ SQL** | ‚úÖ –û—Ç–ª–∏—á–Ω–æ–µ –¥–ª—è PostgreSQL | ‚úÖ –í—Å–µ —Ö–æ—Ä–æ—à–æ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è |
| **–†—É—Å—Å–∫–∏–π —è–∑—ã–∫** | ‚úÖ –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ | ‚úÖ –í—Å–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç |
| **API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** | üåç –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier: 15 RPM | OpenAI: –¢—Ä–µ–±—É–µ—Ç –æ–ø–ª–∞—Ç—ã |

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è MVP:

1. **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier**: 15 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞
2. **–°–∫–æ—Ä–æ—Å—Ç—å**: Flash –º–æ–¥–µ–ª—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è low-latency –∑–∞–¥–∞—á
3. **–ë–æ–ª—å—à–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**: –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–æ–ª–Ω—É—é —Å—Ö–µ–º—É –ë–î –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
4. **Multimodal**: –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≥—Ä–∞—Ñ–∏–∫–æ–≤

---

## üîç –ü–æ–¥—Ö–æ–¥ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL

### 1. Prompt Engineering

–ò—Å–ø–æ–ª—å–∑—É–µ–º **–¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø–æ–¥—Ö–æ–¥**:

#### –≠—Ç–∞–ø 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL + –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –≥—Ä–∞—Ñ–∏–∫–∞

```typescript
const prompt = `
–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL:
${DATABASE_SCHEMA}

–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "${userQuestion}"

–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π JSON:
{
  "sql": "SELECT ...",
  "explanation": "–ö—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ",
  "chartType": "line|bar|pie"
}
`;
```

#### –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```typescript
const interpretPrompt = `
–í–æ–ø—Ä–æ—Å: "${userQuestion}"
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã SQL: ${JSON.stringify(data)}

–°–æ–∑–¥–∞–π –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è).
`;
```

### 2. SQL –í–∞–ª–∏–¥–∞—Ü–∏—è

**3-—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞:**

```typescript
// 1. –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è: —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
sql = sanitizeSQL(sql);

// 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
const dangers = ['DELETE', 'DROP', 'TRUNCATE', 'UPDATE', 'INSERT'];
if (dangers.some(d => sql.toUpperCase().includes(d))) {
  throw new ValidationError('Forbidden operation');
}

// 3. Whitelist —Ç–∞–±–ª–∏—Ü
const allowedTables = ['sessions', 'events'];
// –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ SQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

// 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π LIMIT
if (!sql.includes('LIMIT')) {
  sql += ' LIMIT 1000';
}
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫:**

```typescript
// –û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ + –æ–¥–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ = –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞
if (data.length === 1 && Object.keys(data[0]).length === 1) {
  // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º label: average_duration ‚Üí "–°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"
  // –°–æ–∑–¥–∞–µ–º Bar Chart —Å –æ–¥–Ω–∏–º —Å—Ç–æ–ª–±—Ü–æ–º
}
```

---

## üöÄ –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+ –∏ npm
- –ê–∫–∫–∞—É–Ω—Ç Supabase (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier)
- Google Gemini API –∫–ª—é—á (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier)

### –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/your-username/heylock.git
cd heylock
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ [supabase.com](https://supabase.com)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor** –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
CREATE TABLE sessions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id TEXT NOT NULL,
  started_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
  duration_seconds INTEGER
);

CREATE TABLE events (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  session_id UUID REFERENCES sessions(id),
  event_name TEXT NOT NULL,
  timestamp TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
  properties JSONB
);

-- RPC —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL
CREATE OR REPLACE FUNCTION execute_raw_sql(sql_query text)
RETURNS json
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
DECLARE
  result json;
BEGIN
  EXECUTE format('SELECT json_agg(t) FROM (%s) t', sql_query) INTO result;
  IF result IS NULL THEN
    result := '[]'::json;
  END IF;
  RETURN result;
EXCEPTION
  WHEN OTHERS THEN
    RAISE EXCEPTION 'SQL Error: %', SQLERRM;
END;
$$;

-- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
GRANT EXECUTE ON FUNCTION execute_raw_sql(text) TO anon;
GRANT EXECUTE ON FUNCTION execute_raw_sql(text) TO authenticated;
GRANT EXECUTE ON FUNCTION execute_raw_sql(text) TO service_role;
```

3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Project URL**, **Anon Key**, **Service Role Key**

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Gemini

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [ai.google.dev](https://ai.google.dev/)
2. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á –≤ [Google AI Studio](https://aistudio.google.com/app/apikey)
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ **Generative Language API** –≤–∫–ª—é—á–µ–Ω –≤ [Google Cloud Console](https://console.cloud.google.com/)

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local`:

```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Google Gemini
GOOGLE_GEMINI_API_KEY=your-gemini-api-key
```

### –®–∞–≥ 6: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

```bash
npm run seed
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç:
- 15 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- 80 —Å–µ—Å—Å–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
- 800 —Å–æ–±—ã—Ç–∏–π 15 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤

### –®–∞–≥ 7: –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ [http://localhost:3000](http://localhost:3000)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
heylock/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chat/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ route.ts         # –û—Å–Ω–æ–≤–Ω–æ–π API endpoint
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx               # Root layout
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                 # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îî‚îÄ‚îÄ globals.css              # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ChatInterface.tsx        # –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ MessageBubble.tsx        # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ ChartRenderer.tsx        # –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≥—Ä–∞—Ñ–∏–∫–æ–≤ (Recharts)
‚îÇ   ‚îú‚îÄ‚îÄ LoadingIndicator.tsx    # –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ ErrorMessage.tsx         # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
‚îÇ
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ ai-service.ts            # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Gemini
‚îÇ   ‚îú‚îÄ‚îÄ database.ts              # Supabase –∫–ª–∏–µ–Ω—Ç –∏ —Ö–µ–ª–ø–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ sql-validator.ts         # –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è SQL
‚îÇ   ‚îú‚îÄ‚îÄ response-formatter.ts   # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ error-handler.ts         # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ types.ts                 # TypeScript —Ç–∏–ø—ã
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ seed-database.ts         # –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ create-tables.sql        # SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
‚îÇ   ‚îî‚îÄ‚îÄ create-rpc-function.sql  # RPC —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è Supabase
‚îÇ
‚îú‚îÄ‚îÄ public/                      # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ .env.local                   # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ Git!)
‚îú‚îÄ‚îÄ .env.example                 # –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ package.json                 # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ tsconfig.json                # TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ tailwind.config.ts           # Tailwind CSS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ next.config.js               # Next.js –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Frontend
- **Next.js 16** (App Router) ‚Äî React —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Å SSR
- **React 19** ‚Äî UI –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- **TypeScript 5** ‚Äî –¢–∏–ø–∏–∑–∞—Ü–∏—è
- **Tailwind CSS 3.4** ‚Äî Utility-first CSS
- **Recharts 3** ‚Äî –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤

### Backend
- **Next.js API Routes** ‚Äî Serverless —Ñ—É–Ω–∫—Ü–∏–∏
- **Google Gemini 2.5 Flash** ‚Äî AI –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL
- **Zod 4** ‚Äî –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### Database
- **Supabase** ‚Äî Backend-as-a-Service
- **PostgreSQL** ‚Äî –†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –ë–î

### DevTools
- **ESLint** ‚Äî –õ–∏–Ω—Ç–µ—Ä
- **PostCSS** ‚Äî CSS –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä
- **tsx** ‚Äî TypeScript executor –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:

```
‚úÖ "–ü–æ–∫–∞–∂–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é"
‚úÖ "–ö–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á–∞—â–µ –≤—Å–µ–≥–æ?"
‚úÖ "–°–∫–æ–ª—å–∫–æ –±—ã–ª–æ —Å–µ—Å—Å–∏–π –≤—á–µ—Ä–∞?"
‚úÖ "–ö–∞–∫–∞—è —Å—Ä–µ–¥–Ω—è—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–π?"
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞

**–í–æ–ø—Ä–æ—Å:** "–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –±—ã–ª–æ —Å–µ—Å—Å–∏–π?"

**SQL (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω Gemini):**
```sql
SELECT COUNT(*) AS total_sessions FROM sessions LIMIT 1000
```

**–û—Ç–≤–µ—Ç:**
- –ì—Ä–∞—Ñ–∏–∫: Bar chart —Å 1 —Å—Ç–æ–ª–±—Ü–æ–º
- Label: "–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π"
- –ó–Ω–∞—á–µ–Ω–∏–µ: "80" (–Ω–∞ –≤–µ—Ä—à–∏–Ω–µ —Å—Ç–æ–ª–±—Ü–∞)

### –ü—Ä–∏–º–µ—Ä 2: –í—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥

**–í–æ–ø—Ä–æ—Å:** "–ü–æ–∫–∞–∂–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é"

**SQL:**
```sql
SELECT DATE(started_at) as date, COUNT(id) as session_count 
FROM sessions 
WHERE started_at >= NOW() - INTERVAL '7 days' 
GROUP BY DATE(started_at) 
ORDER BY date LIMIT 1000
```

**–û—Ç–≤–µ—Ç:**
- –ì—Ä–∞—Ñ–∏–∫: Line chart —Å 7 —Ç–æ—á–∫–∞–º–∏
- X-axis: –î–∞—Ç—ã
- Y-axis: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π

### –ü—Ä–∏–º–µ—Ä 3: –¢–æ–ø —Å–æ–±—ã—Ç–∏–π

**–í–æ–ø—Ä–æ—Å:** "–ö–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á–∞—â–µ –≤—Å–µ–≥–æ?"

**SQL:**
```sql
SELECT event_name, COUNT(*) as count 
FROM events 
GROUP BY event_name 
ORDER BY count DESC 
LIMIT 1000
```

**–û—Ç–≤–µ—Ç:**
- –ì—Ä–∞—Ñ–∏–∫: Bar chart —Å —Ç–æ–ø-15 —Å–æ–±—ã—Ç–∏–π
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ü–æ —É–±—ã–≤–∞–Ω–∏—é

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### SQL Injection Protection

1. ‚úÖ **Sanitization**: –£–¥–∞–ª–µ–Ω–∏–µ SQL –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
2. ‚úÖ **Validation**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (DELETE, DROP, UPDATE)
3. ‚úÖ **Whitelist**: –¢–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü—ã `sessions` –∏ `events`
4. ‚úÖ **Auto-LIMIT**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–º–∞–∫—Å. 1000)
5. ‚úÖ **Prepared Statements**: Supabase RPC –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. [LICENSE](LICENSE) —Ñ–∞–π–ª
